{{- $headers := findRE "<h[1-6].*?>(.|\n])+?</h[1-6]>" .Content -}}
{{- $has_headers := ge (len $headers) 1 -}}
{{- if $has_headers -}}
<nav class="sidebar-toc">
    <div class="toc-title">{{- .Site.Params.Toc.title | default "目录" }}</div>
    <div class="toc-content">
        {{- if (.Param "UseHugoToc") }}
        {{- .TableOfContents -}}
        {{- else }}
        {{- $largest := 6 -}}
        {{- range $headers -}}
        {{- $headerLevel := index (findRE "[1-6]" . 1) 0 -}}
        {{- $headerLevel := len (seq $headerLevel) -}}
        {{- if lt $headerLevel $largest -}}
        {{- $largest = $headerLevel -}}
        {{- end -}}
        {{- end -}}

        {{- $firstHeaderLevel := len (seq (index (findRE "[1-6]" (index $headers 0) 1) 0)) -}}

        <ul class="toc-list">
            {{- range $i, $header := $headers -}}
            {{- $headerLevel := index (findRE "[1-6]" . 1) 0 -}}
            {{- $headerLevel := len (seq $headerLevel) -}}

            {{- $id := index (findRE "(id=\"(.*?)\")" $header 9) 0 }}
            {{- $cleanedID := replace (replace $id "id=\"" "") "\"" "" }}
            {{- $headerText := replaceRE "<h[1-6].*?>((.|\n])+?)</h[1-6]>" "$1" $header -}}
            {{- $headerText = $headerText | plainify | safeHTML -}}

            <li class="toc-level-{{ $headerLevel }}">
                <a href="#{{- $cleanedID -}}" class="toc-link">{{- $headerText -}}</a>
            </li>
            {{- end -}}
        </ul>
        {{- end }}
    </div>
</nav>
{{- end }}